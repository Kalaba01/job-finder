<!DOCTYPE html>
<html lang="<%= locale %>" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= __("UserManagement.title") %></title>
    <link rel="stylesheet" href="/styles/users.css" />
    <link rel="icon" type="image/png" href="/images/logo.png" />
    <link
      rel="stylesheet"
      href="/node_modules/nouislider/dist/nouislider.min.css"
    />
    <script src="/node_modules/nouislider/dist/nouislider.min.js"></script>
  </head>
  <body
    data-title="<%= __('UserManagement.title') %>"
    data-add-user-title="<%= __('UserManagement.modal.addUserTitle') %>"
    data-edit-user-title="<%= __('UserManagement.modal.editUserTitle') %>"
    data-select-role="<%= __('UserManagement.modal.selectRole') %>"
    data-choose-role="<%= __('UserManagement.modal.chooseRole') %>"
    data-email-label="<%= __('UserManagement.modal.email') %>"
    data-password-label="<%= __('UserManagement.modal.password') %>"
    data-firm-name-label="<%= __('UserManagement.modal.firmName') %>"
    data-city-label="<%= __('UserManagement.modal.cityLabel') %>"
    data-city-placeholder="<%= __('UserManagement.modal.cityPlaceholder') %>"
    data-firm-address-label="<%= __('UserManagement.modal.firmAddress') %>"
    data-number-of-employees-label="<%= __('UserManagement.modal.numberOfEmployees') %>"
    data-selected-range="<%= __('UserManagement.modal.selectedRange') %>"
    data-first-name-label="<%= __('UserManagement.modal.firstName') %>"
    data-last-name-label="<%= __('UserManagement.modal.lastName') %>"
    data-save="<%= __('UserManagement.modal.save') %>"
    data-cancel="<%= __('UserManagement.modal.cancel') %>"
    data-delete-user-title="<%= __('UserManagement.confirmModal.title') %>"
    data-delete-user-message="<%= __('UserManagement.confirmModal.message') %>"
    data-yes="<%= __('UserManagement.confirmModal.yes') %>"
    data-no="<%= __('UserManagement.confirmModal.no') %>"
    data-user-added-successfully="<%= __('UserManagement.success.userAdded') %>"
    data-user-updated-successfully="<%= __('UserManagement.success.userUpdated') %>"
    data-failed-to-process-user="<%= __('UserManagement.errors.failedToProcess') %>"
    data-error-processing-user="<%= __('UserManagement.errors.errorProcessing') %>"
    data-user-deleted-successfully="<%= __('UserManagement.success.userDeleted') %>"
    data-failed-to-delete-user="<%= __('UserManagement.errors.failedToDelete') %>"
    data-error-deleting-user="<%= __('UserManagement.errors.errorDeleting') %>"
    data-error-fetching-user-details="<%= __('UserManagement.errors.errorFetchingDetails') %>"
    data-an-error-occurred-processing-user="<%= __('UserManagement.errors.generalError') %>"
  >
    <%- include('../partials/top-bar') %>
    <div class="container">
      <h1><%= __("UserManagement.title") %></h1>
      <table>
        <thead>
          <tr>
            <th><%= __("UserManagement.tableHeaders.id") %></th>
            <th><%= __("UserManagement.tableHeaders.email") %></th>
            <th><%= __("UserManagement.tableHeaders.role") %></th>
            <th><%= __("UserManagement.tableHeaders.createdAt") %></th>
            <th><%= __("UserManagement.tableHeaders.updatedAt") %></th>
            <th><%= __("UserManagement.tableHeaders.actions") %></th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(user => { %>
          <tr>
            <td><%= user.id %></td>
            <td><%= user.email %></td>
            <td><%= __("UserManagement.roles." + user.role) %></td>
            <td><%= user.createdAt.toLocaleString() %></td>
            <td><%= user.updatedAt.toLocaleString() %></td>
            <td class="action-buttons">
              <button
                class="edit-btn"
                data-id="<%= user.id %>"
                data-email="<%= user.email %>"
                data-role="<%= user.role %>"
              >
                <%= __("UserManagement.buttons.edit") %>
              </button>
              <button class="delete-btn" data-id="<%= user.id %>">
                <%= __("UserManagement.buttons.delete") %>
              </button>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
      <div class="add-user">
        <button class="add-btn" id="open-modal-btn">
          <%= __("UserManagement.buttons.addUser") %>
        </button>
      </div>
    </div>

    <!-- Modal for Adding/Editing User -->
    <div id="user-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn" id="close-modal-btn">&times;</span>
        <h2 id="modal-title"><%= __("UserManagement.modal.addUserTitle") %></h2>
        <hr class="modal-divider" />
        <form id="add-user-form">
          <div id="role-select-container" class="form-group">
            <label for="role-select"
              ><%= __("UserManagement.modal.selectRole") %></label
            >
            <select id="role-select" name="role" required>
              <option value="" disabled selected>
                <%= __("UserManagement.modal.chooseRole") %>
              </option>
              <option value="admin">
                <%= __("UserManagement.roles.admin") %>
              </option>
              <option value="firm">
                <%= __("UserManagement.roles.firm") %>
              </option>
              <option value="candidate">
                <%= __("UserManagement.roles.candidate") %>
              </option>
            </select>
          </div>
          <div id="role-specific-fields">
            <!-- Dynamic fields will be inserted here -->
          </div>
          <div class="modal-footer">
            <button type="submit" class="save-btn">
              <%= __("UserManagement.modal.save") %>
            </button>
            <button type="button" class="cancel-btn" id="close-modal-btn">
              <%= __("UserManagement.modal.cancel") %>
            </button>
          </div>
        </form>
      </div>
    </div>

    <%- include('../partials/confirm') %>

    <script src="/js/users.js"></script>
  </body>
</html>
